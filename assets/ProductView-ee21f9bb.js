import{J as L,H as C,G as T,L as P,a6 as B,N as M,O as p,Q as V,R as s,$ as b,o as t,aa as N,W as i,ab as U,ac as $,X as v,a0 as x,ad as A,ae as D,Y as W,af as z,a3 as R,_ as E,ag as G,P as H,U as J,T as O,ah as Q,ai as X,a1 as Y,a2 as j}from"./index-3d9fa740.js";import{u as K,a as k}from"./vee-validate.esm-4e8ca87b.js";import{V as Z}from"./VForm-e1cfac01.js";import{V as ee}from"./VSelect-67349047.js";import{g as te}from"./index-0fa819ad.js";import{V as ae,a as oe}from"./VContainer-f0e7e319.js";import{a as S,V as se}from"./VRow-106113c8.js";import"./VList-1c2d2341.js";import"./ssrBoot-5e80b69f.js";const re={class:"overflow-hidden",style:{"margin-bottom":"10px"}},le={style:{"background-color":"white",padding:"5px"}},ne={__name:"ProductCard",props:["_id","category","description","images","name","price","sell"],setup(r){const{api:_,apiAuth:g}=R(),m=L(),n=C(),d=T(),a=r,f=["直麵","筆管麵","寬扁麵"],c=P({_id:"",name:"",price:0,description:"",images:[],sell:!0,category:""}),{isSubmitting:y,handleSubmit:q}=K({initialValues:{quantity:1,noodle:"直麵"}}),w=k("quantity"),h=k("noodle"),F=q(async u=>{var l,e;if(!m.isLogin){n({text:"請先登入再加入購物車",showCloseButton:!1,snackbarProps:{timeout:1e3,color:"red",location:"bottom"}}),d.push("/signup");return}try{const{data:o}=await g.patch("/users/cart",{product:a._id,quantity:u.quantity,noodle:u.noodle});m.cart=o.result,n({text:"新增成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}})}catch(o){const I=((e=(l=o==null?void 0:o.response)==null?void 0:l.data)==null?void 0:e.message)||"發生錯誤，請稍後再試";n({text:I,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}});return B(async()=>{var u,l;try{const{data:e}=await _.get("/products/");c.value._id=e.result._id,c.value.name=e.result.name,c.value.price=e.result.price,c.value.images=e.result.images,c.value.description=e.result.description,c.value.category=e.result.category,c.value.sell=e.result.sell}catch(e){const o=((l=(u=e==null?void 0:e.response)==null?void 0:u.data)==null?void 0:l.message)||"發生錯誤，請稍後再試";n({text:o,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}}),d.push("/")}}),(u,l)=>{const e=M("RouterLink");return p(),V(z,{class:"product-card"},{default:s(()=>[b("div",re,[t(e,{class:"text-decoration-none",to:"/products/"+r._id},{default:s(()=>[t(N,{class:"img-enlarge",src:u.image,cover:"",width:"100%",height:"300"},null,8,["src"])]),_:1},8,["to"])]),b("div",le,[t(Z,{disabled:i(y),onSubmit:U(i(F),["prevent"])},{default:s(()=>[t($,null,{default:s(()=>[t(e,{class:"text-primary text-decoration-none",to:"/products/"+r._id},{default:s(()=>[v(x(r.name),1)]),_:1},8,["to"])]),_:1}),t(A,null,{default:s(()=>[v("$"+x(r.price),1)]),_:1}),t(ee,{label:"麵條種類",items:f,modelValue:i(h).value.value,"onUpdate:modelValue":l[0]||(l[0]=o=>i(h).value.value=o),"error-messages":i(h).errorMessage.value},null,8,["modelValue","error-messages"]),t(D,{type:"number",min:"1",modelValue:i(w).value.value,"onUpdate:modelValue":l[1]||(l[1]=o=>i(w).value.value=o),modelModifiers:{number:!0},variant:"outlined",placeholder:"數量"},null,8,["modelValue"]),t(W,{type:"submit",color:"primary","prepend-icon":"mdi-cart",loading:i(y),style:{width:"100%",height:"50px"}},{default:s(()=>[v("加入購物車")]),_:1},8,["loading"])]),_:1},8,["disabled","onSubmit"])])]),_:1})}}};const ie=r=>(Y("data-v-93032d45"),r=r(),j(),r),ce=ie(()=>b("h1",{class:"text-center"},"商品資訊",-1)),ue={__name:"ProductView",setup(r){const{api:_}=R(),g=C(),m=P([]);return B(async()=>{var n,d;try{const{data:a}=await _.get("/products",{params:{itemsPerPage:-1}});m.value.push(...a.result.data),await G(),te.to(".product-card",{opacity:1,duration:.5})}catch(a){console.log(a);const f=((d=(n=a==null?void 0:a.response)==null?void 0:n.data)==null?void 0:d.message)||"發生錯誤，請稍後再試";g({text:f,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}}),(n,d)=>(p(),V(ae,{class:"w-75"},{default:s(()=>[t(se,null,{default:s(()=>[t(S,{cols:"12"},{default:s(()=>[ce]),_:1}),t(oe),(p(!0),H(O,null,J(m.value,a=>(p(),V(S,{cols:"12",sm:"6",md:"4",lg:"3",key:a._id},{default:s(()=>[t(ne,Q(X(a)),null,16)]),_:2},1024))),128))]),_:1})]),_:1}))}},be=E(ue,[["__scopeId","data-v-93032d45"]]);export{be as default};
