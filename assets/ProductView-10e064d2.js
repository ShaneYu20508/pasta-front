import{$ as L,Z as C,Y as M,x as P,A as B,a1 as T,a2 as p,a4 as v,a5 as s,ac as V,c as t,V as $,a9 as i,aj as A,ak as N,aa as h,ad as x,al as U,am as D,J as j,an as z,ag as q,_ as E,ao as J,a3 as W,a8 as Y,a7 as Z,ap as G,aq as H,ae as K,af as O}from"./index-679bad59.js";import{u as Q,a as k}from"./vee-validate.esm-9e2737c4.js";import{V as X}from"./VForm-446ec159.js";import{V as ee}from"./VSelect-626dbc52.js";import{g as te}from"./index-0fa819ad.js";import{V as ae,b as S,a as oe}from"./VRow-365b3ca4.js";import{V as se}from"./VDivider-1f4be66a.js";import"./VList-ece80feb.js";import"./ssrBoot-0f8d64ba.js";const re={class:"overflow-hidden",style:{"margin-bottom":"10px"}},le={style:{"background-color":"white",padding:"5px"}},ne={__name:"ProductCard",props:["_id","category","description","images","name","price","sell"],setup(r){const{api:_,apiAuth:g}=q(),m=L(),n=C(),d=M(),a=r,f=["直麵","筆管麵","寬扁麵"],c=P({_id:"",name:"",price:0,description:"",images:[],sell:!0,category:""}),{isSubmitting:y,handleSubmit:F}=Q({initialValues:{quantity:1,noodle:"直麵"}}),w=k("quantity"),b=k("noodle"),I=F(async u=>{var l,e;if(!m.isLogin){n({text:"請先登入再加入購物車",showCloseButton:!1,snackbarProps:{timeout:1e3,color:"red",location:"bottom"}}),d.push("/signup");return}try{const{data:o}=await g.patch("/users/cart",{product:a._id,quantity:u.quantity,noodle:u.noodle});m.cart=o.result,n({text:"新增成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}})}catch(o){const R=((e=(l=o==null?void 0:o.response)==null?void 0:l.data)==null?void 0:e.message)||"發生錯誤，請稍後再試";n({text:R,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}});return B(async()=>{var u,l;try{const{data:e}=await _.get("/products/");c.value._id=e.result._id,c.value.name=e.result.name,c.value.price=e.result.price,c.value.images=e.result.images,c.value.description=e.result.description,c.value.category=e.result.category,c.value.sell=e.result.sell}catch(e){const o=((l=(u=e==null?void 0:e.response)==null?void 0:u.data)==null?void 0:l.message)||"發生錯誤，請稍後再試";n({text:o,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}}),d.push("/")}}),(u,l)=>{const e=T("RouterLink");return p(),v(z,{class:"product-card"},{default:s(()=>[V("div",re,[t(e,{class:"text-decoration-none",to:"/products/"+r._id},{default:s(()=>[t($,{class:"img-enlarge",src:u.image,cover:"",width:"100%",height:"300"},null,8,["src"])]),_:1},8,["to"])]),V("div",le,[t(X,{disabled:i(y),onSubmit:A(i(I),["prevent"])},{default:s(()=>[t(N,null,{default:s(()=>[t(e,{class:"text-primary text-decoration-none",to:"/products/"+r._id},{default:s(()=>[h(x(r.name),1)]),_:1},8,["to"])]),_:1}),t(U,null,{default:s(()=>[h("$"+x(r.price),1)]),_:1}),t(ee,{label:"麵條種類",items:f,modelValue:i(b).value.value,"onUpdate:modelValue":l[0]||(l[0]=o=>i(b).value.value=o),"error-messages":i(b).errorMessage.value},null,8,["modelValue","error-messages"]),t(D,{type:"number",min:"1",modelValue:i(w).value.value,"onUpdate:modelValue":l[1]||(l[1]=o=>i(w).value.value=o),modelModifiers:{number:!0},variant:"outlined",placeholder:"數量"},null,8,["modelValue"]),t(j,{type:"submit",color:"primary","prepend-icon":"mdi-cart",loading:i(y),style:{width:"100%",height:"50px"}},{default:s(()=>[h("加入購物車")]),_:1},8,["loading"])]),_:1},8,["disabled","onSubmit"])])]),_:1})}}};const ie=r=>(K("data-v-8798bf52"),r=r(),O(),r),ce=ie(()=>V("h1",{class:"text-center"},"商品資訊",-1)),ue={__name:"ProductView",setup(r){const{api:_}=q(),g=C(),m=P([]);return B(async()=>{var n,d;try{const{data:a}=await _.get("/products",{params:{itemsPerPage:-1}});m.value.push(...a.result.data),await J(),te.to(".product-card",{opacity:1,duration:.5})}catch(a){console.log(a);const f=((d=(n=a==null?void 0:a.response)==null?void 0:n.data)==null?void 0:d.message)||"發生錯誤，請稍後再試";g({text:f,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}}),(n,d)=>(p(),v(ae,{class:"w-75"},{default:s(()=>[t(oe,null,{default:s(()=>[t(S,{cols:"12"},{default:s(()=>[ce]),_:1}),t(se),(p(!0),W(Z,null,Y(m.value,a=>(p(),v(S,{cols:"12",md:"6",lg:"3",key:a._id},{default:s(()=>[t(ne,G(H(a)),null,16)]),_:2},1024))),128))]),_:1})]),_:1}))}},Ve=E(ue,[["__scopeId","data-v-8798bf52"]]);export{Ve as default};
