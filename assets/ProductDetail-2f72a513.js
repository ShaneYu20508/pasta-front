import{aH as C,G as $,H as F,J as M,L as P,a6 as R,O as E,P as N,o as a,R as o,aI as T,T as U,a3 as A,$ as n,a0 as m,aa as D,W as l,ab as H,ae as I,Y as V,X as y}from"./index-60588b11.js";import{u as L,a as _}from"./vee-validate.esm-a3125148.js";import{c as O,d as j,a as G}from"./index.esm-639fe0e0.js";import{V as J}from"./VContainer-00e3adad.js";import{V as W,a as p}from"./VRow-bca670f5.js";import{V as X}from"./VForm-f44f6605.js";import{V as Y}from"./VSelect-0e4b9d66.js";import"./VList-f7383c42.js";import"./ssrBoot-cc27db3c.js";const z={style:{"white-space":"pre"}},K=n("h1",{class:"text-red text-h1"},"已下架",-1),ne={__name:"ProductDetail",setup(Q){const b=C(),v=$(),{api:h,apiAuth:x}=A(),i=F(),f=M(),w=["直麵","筆管麵","寬扁麵"],t=P({_id:"",name:"",price:0,description:"",image:"",sell:!0,category:""}),S=O({quantity:j().typeError("缺少數量").required("缺少數量").min(1,"數量最小為 1"),noodle:G().typeError("缺少麵條種類").required("缺少麵條種類")}),{isSubmitting:g,handleSubmit:q}=L({validationSchema:S,initialValues:{noodle:"直麵",quantity:1}}),c=_("quantity"),d=_("noodle"),B=q(async u=>{var s,e;if(!f.isLogin){v.push("/login");return}try{const{data:r}=await x.patch("/users/cart",{product:t.value._id,quantity:u.quantity,noodle:u.noodle});f.cart=r.result,i({text:"新增成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}})}catch(r){const k=((e=(s=r==null?void 0:r.response)==null?void 0:s.data)==null?void 0:e.message)||"發生錯誤，請稍後再試";i({text:k,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}});return R(async()=>{var u,s;try{const{data:e}=await h.get("/products/"+b.params.id);t.value._id=e.result._id,t.value.name=e.result.name,t.value.price=e.result.price,t.value.description=e.result.description,t.value.image=e.result.image,t.value.sell=e.result.sell,t.value.category=e.result.category,document.title=`購物網| ${t.value.name}`}catch(e){const r=((s=(u=e==null?void 0:e.response)==null?void 0:u.data)==null?void 0:s.message)||"發生錯誤，請稍後再試";i({text:r,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}}),v.push("/")}}),(u,s)=>(E(),N(U,null,[a(J,null,{default:o(()=>[a(W,null,{default:o(()=>[a(p,{cols:"12"},{default:o(()=>[n("h1",null,m(t.value.name),1)]),_:1}),a(p,{cols:"12",md:"6"},{default:o(()=>[a(D,{src:t.value.image},null,8,["src"])]),_:1}),a(p,{cols:"12",md:"6"},{default:o(()=>[n("p",null,"$"+m(t.value.price),1),n("p",z,m(t.value.description),1),a(X,{disabled:l(g),onSubmit:H(l(B),["prevent"])},{default:o(()=>[a(Y,{label:"麵條種類",modelValue:l(d).value.value,"onUpdate:modelValue":s[0]||(s[0]=e=>l(d).value.value=e),items:w,"error-messages":l(d).errorMessage.value},null,8,["modelValue","error-messages"]),a(I,{type:"number",min:"0",modelValue:l(c).value.value,"onUpdate:modelValue":s[1]||(s[1]=e=>l(c).value.value=e),modelModifiers:{number:!0},"error-messages":l(c).errorMessage.value},null,8,["modelValue","error-messages"]),a(V,{type:"submit","prepend-icon":"mdi-cart",loading:l(g)},{default:o(()=>[y("加入購物車")]),_:1},8,["loading"])]),_:1},8,["disabled","onSubmit"])]),_:1})]),_:1})]),_:1}),a(T,{class:"align-center justify-center text-center","model-value":!t.value.sell,persistent:""},{default:o(()=>[K,a(V,{to:"/",color:"green"},{default:o(()=>[y("回首頁")]),_:1})]),_:1},8,["model-value"])],64))}};export{ne as default};
